<!DOCTYPE html>
<html>
<head>
	<link rel='stylesheet' href='dist/fullcalendar/fullcalendar.css' />
	<script src='dist/lib/jquery/dist/jquery.min.js'></script>
	<script src='dist/lib/moment/min/moment.min.js'></script>
	<script src='api/api.js'></script>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.6/moment.min.js"></script>   
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.17.37/js/bootstrap-datetimepicker.min.js"></script>
	<script src='dist/fullcalendar/fullcalendar.js'></script>

	<script src="https://apis.google.com/js/platform.js"></script>
	<meta name="google-signin-client_id" content="619527313666-fo2k03rjj7e8te5qd1ktvtkk718pr28h.apps.googleusercontent.com">

	<script>
		//var events = [];
		var auth2;

		function initClient(callback) {
		    gapi.load('auth2', function(){
		        /**
		         * Retrieve the singleton for the GoogleAuth library and set up the
		         * client.
		         */
		        auth2 = gapi.auth2.init({
		            client_id: '619527313666-fo2k03rjj7e8te5qd1ktvtkk718pr28h.apps.googleusercontent.com'
		        });

		        // Attach the click handler to the sign-in button
		        //auth2.attachClickHandler('signin-button', {}, onSuccess, onFailure);
		        callback();
		    });
		};

		$(document).ready(function() {
		    $('#calendar').fullCalendar({
		    	dayClick: function(date, jsEvent, view) {
		    		jasonAddEvent(globalUserId, date.format());
		    	},
		    	eventClick: function(calEvent, jsEvent, view) {
		    		var result = confirm("Do you want to delete " + calEvent.title + "? (Click Cancel to edit event)");
		    		if (result == true) {
		    			deleteEvent(calEvent, globalUserId);
		    		} else {
		    			editEvent(calEvent, globalUserId);
		    		}
				},
		    })

			initClient(function() {
				if (auth2.isSignedIn.get()) {
					var profile = auth2.currentUser.get().getBasicProfile();
					console.log('ID: ' + profile.getId());
					console.log('Full Name: ' + profile.getName());
					console.log('Given Name: ' + profile.getGivenName());
					console.log('Family Name: ' + profile.getFamilyName());
					console.log('Image URL: ' + profile.getImageUrl());
					console.log('Email: ' + profile.getEmail());
				} else {
					console.log("User not signed in");
					//window.location = "http://localhost:8080/login.html";
				}
			});

			getEvents(1, function(data) {
				refreshCalendar(makeEvents(data["events"]));
			})
		});

		function refreshCalendar(events) {
			$('#calendar').fullCalendar('removeEvents');
			$('#calendar').fullCalendar('renderEvents', events, true);
		}

		function makeEvents(events) { 
			var eventArray = [];

			for(index in events) { 

				eventArray.push({
					eventId: events[index]["eventId"],
					userId: events[index]["userId"],
					title: events[index]["title"],
					start: moment(events[index]["start"]).format(),
					end: moment(events[index]["end"]).format()
				})
			}

			console.log(eventArray);
			return eventArray;
		}

	</script>

	<style>
		p {
			font-family: Arial;
		}

		body { 
			padding: 50px;
		}
	</style>
</head>
<body>
	<a href="login.html">Logout</a>
	<div id='calendar' style='width:50%; height:50%;'></div>
</bodY>
</html>
